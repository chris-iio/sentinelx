{% extends "base.html" %}

{% block content %}
<div class="page-settings">
    <div class="settings-card">
        <h1 class="settings-title">Settings</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
        {% endfor %}
        {% endwith %}

        <section class="settings-section">
            <h2 class="settings-section-title">VirusTotal API Key</h2>

            <p class="settings-info">
                Your API key is stored locally in <code>~/.sentinelx/config.ini</code>.
                It is never transmitted except to the VirusTotal API.
            </p>
            <p class="settings-info">
                Get a free API key at
                <a href="https://www.virustotal.com/gui/join" target="_blank" rel="noopener noreferrer">
                    https://www.virustotal.com/gui/join
                </a>
            </p>
            <p class="settings-note">
                Note: API key is validated on first enrichment use, not on save.
            </p>

            <form method="post" action="{{ url_for('main.settings_post') }}" id="settings-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                <div class="form-field">
                    <label for="api-key" class="form-label">API Key</label>
                    <div class="input-group">
                        <input
                            type="password"
                            id="api-key"
                            name="api_key"
                            class="form-input"
                            value="{{ masked_key or '' }}"
                            placeholder="Paste your VirusTotal API key here"
                            autocomplete="off"
                            spellcheck="false"
                        />
                        <button
                            type="button"
                            class="btn btn-secondary"
                            id="toggle-key-btn"
                            aria-label="Show or hide API key"
                        >Show</button>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save API Key</button>
                </div>
            </form>
        </section>
    </div>
</div>

{% endblock %}
