---
phase: 11-foundation-design-tokens-base-css
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/static/fonts/InterVariable.woff2
  - app/static/fonts/JetBrainsMonoVariable.woff2
  - app/static/src/input.css
  - app/templates/base.html
  - tailwind.config.js
autonomous: true
requirements:
  - FOUND-02
  - FOUND-03
  - FOUND-04
  - FOUND-07

must_haves:
  truths:
    - "Inter Variable font file exists at app/static/fonts/InterVariable.woff2 and loads with HTTP 200 in the browser"
    - "JetBrains Mono Variable font file exists at app/static/fonts/JetBrainsMonoVariable.woff2 and loads with HTTP 200 in the browser"
    - "Browser DevTools shows color-scheme: dark on :root and dark scrollbars render on all pages"
    - "Tailwind CSS builds successfully with @tailwindcss/forms plugin and darkMode: selector config"
  artifacts:
    - path: "app/static/fonts/InterVariable.woff2"
      provides: "Inter Variable font for UI chrome text"
    - path: "app/static/fonts/JetBrainsMonoVariable.woff2"
      provides: "JetBrains Mono Variable font for IOC values"
    - path: "app/templates/base.html"
      provides: "Font preload links, color-scheme meta tag"
      contains: "color-scheme"
    - path: "tailwind.config.js"
      provides: "darkMode selector config, @tailwindcss/forms plugin"
      contains: "darkMode"
    - path: "app/static/src/input.css"
      provides: "@font-face declarations for both variable fonts"
      contains: "Inter Variable"
  key_links:
    - from: "app/templates/base.html"
      to: "app/static/fonts/InterVariable.woff2"
      via: "preload link with crossorigin attribute"
      pattern: "preload.*InterVariable"
    - from: "app/static/src/input.css"
      to: "app/static/fonts/InterVariable.woff2"
      via: "@font-face src url"
      pattern: "url.*InterVariable"
    - from: "app/static/src/input.css"
      to: "app/static/fonts/JetBrainsMonoVariable.woff2"
      via: "@font-face src url"
      pattern: "url.*JetBrainsMonoVariable"
---

<objective>
Download and configure self-hosted Inter Variable and JetBrains Mono Variable fonts, add dark-mode browser signals, and update Tailwind config with darkMode selector and @tailwindcss/forms plugin.

Purpose: Establish the font infrastructure and browser dark-mode foundation that all subsequent Phase 11 and Phase 12+ work depends on. Fonts must load before token/component work begins so typography tokens can reference real font families.

Output: Two woff2 font files in app/static/fonts/, @font-face declarations in input.css, preload links and color-scheme meta in base.html, updated tailwind.config.js.
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-foundation-design-tokens-base-css/11-RESEARCH.md
@app/static/src/input.css
@app/templates/base.html
@tailwind.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Download variable fonts and add @font-face declarations</name>
  <files>
    app/static/fonts/InterVariable.woff2
    app/static/fonts/JetBrainsMonoVariable.woff2
    app/static/src/input.css
  </files>
  <action>
1. Create the `app/static/fonts/` directory.

2. Download Inter Variable woff2 from the rsms/inter GitHub releases. The file should be the Latin subset variable font (~70KB). Use curl to download. If the exact filename on the release differs, rename to `InterVariable.woff2` after download.

   Recommended download URL (check releases page if this 404s):
   ```
   curl -L -o app/static/fonts/InterVariable.woff2 "https://github.com/rsms/inter/releases/download/v4.1/InterVariable.woff2"
   ```
   If that exact URL fails, go to https://github.com/rsms/inter/releases and find the latest release. Look for InterVariable.woff2 in the assets. The file should be ~300KB or less.

3. Download JetBrains Mono Variable woff2 from JetBrains/JetBrainsMono GitHub releases. Use curl. Rename to `JetBrainsMonoVariable.woff2` if the release filename differs.

   Recommended approach: Download the release zip, extract the woff2 variable font, rename.
   ```
   curl -L -o /tmp/jbmono.zip "https://github.com/JetBrains/JetBrainsMono/releases/download/v2.304/JetBrainsMono-2.304.zip"
   unzip -j /tmp/jbmono.zip "fonts/variable/*[wght].woff2" -d app/static/fonts/
   ```
   Then rename the extracted file to `JetBrainsMonoVariable.woff2`. If the zip structure differs, explore the zip contents first with `unzip -l`.

4. Add @font-face declarations at the TOP of `app/static/src/input.css`, BEFORE the `@tailwind base;` directive. Place them outside any @layer block. Use these exact declarations:

   ```css
   @font-face {
       font-family: 'Inter Variable';
       font-style: normal;
       font-weight: 100 900;
       font-display: swap;
       src: url('/static/fonts/InterVariable.woff2') format('woff2');
   }

   @font-face {
       font-family: 'JetBrains Mono Variable';
       font-style: normal;
       font-weight: 100 800;
       font-display: swap;
       src: url('/static/fonts/JetBrainsMonoVariable.woff2') format('woff2');
   }
   ```

   IMPORTANT: The `src: url()` path must use the browser-visible URL path (`/static/fonts/...`), NOT the filesystem path (`app/static/fonts/...`). Flask serves static files at `/static/` by default.

5. Verify both font files exist and have reasonable sizes:
   ```
   ls -la app/static/fonts/*.woff2
   ```
   Inter should be ~70-350KB, JetBrains Mono should be ~60-200KB.
  </action>
  <verify>
    <automated>ls -la app/static/fonts/InterVariable.woff2 app/static/fonts/JetBrainsMonoVariable.woff2 && grep -c "Inter Variable" app/static/src/input.css && grep -c "JetBrains Mono Variable" app/static/src/input.css</automated>
    <manual>Confirm both woff2 files are non-empty and @font-face declarations appear before @tailwind directives in input.css</manual>
  </verify>
  <done>Both woff2 files exist in app/static/fonts/, and @font-face declarations for Inter Variable (weight 100-900) and JetBrains Mono Variable (weight 100-800) appear at the top of input.css with correct /static/fonts/ URL paths and font-display: swap</done>
</task>

<task type="auto">
  <name>Task 2: Update base.html with preload links and color-scheme meta, update tailwind.config.js</name>
  <files>
    app/templates/base.html
    tailwind.config.js
  </files>
  <action>
1. Edit `app/templates/base.html` — add these elements to the `<head>` section, in this order:
   - After the viewport meta tag, add: `<meta name="color-scheme" content="dark">`
   - Before the stylesheet `<link>`, add font preload links:
     ```html
     <link rel="preload"
           href="{{ url_for('static', filename='fonts/InterVariable.woff2') }}"
           as="font"
           type="font/woff2"
           crossorigin>
     <link rel="preload"
           href="{{ url_for('static', filename='fonts/JetBrainsMonoVariable.woff2') }}"
           as="font"
           type="font/woff2"
           crossorigin>
     ```
   The `crossorigin` attribute is REQUIRED on font preload links even for same-origin resources — without it, browsers double-fetch the font.

   The final `<head>` order should be: charset meta, viewport meta, color-scheme meta, title, favicon link, preload Inter, preload JetBrains Mono, stylesheet link.

2. Edit `tailwind.config.js` — add two changes:
   - Add `darkMode: 'selector',` after the `content:` array (before `safelist:`).
   - Replace `plugins: [],` with:
     ```js
     plugins: [
         require('@tailwindcss/forms'),
     ],
     ```
   The @tailwindcss/forms plugin is bundled in the Tailwind standalone CLI binary — no npm install needed.

3. Run `make css` to verify the Tailwind build succeeds with the new config. If `@tailwindcss/forms` throws a module resolution error, the standalone CLI version may not bundle it — check `./tools/tailwindcss --help` for version info.

4. Run `pytest tests/ -x -q --timeout=30` to confirm no existing tests are broken by the base.html or config changes.
  </action>
  <verify>
    <automated>grep -c "color-scheme" app/templates/base.html && grep -c "preload" app/templates/base.html && grep "darkMode" tailwind.config.js && grep "tailwindcss/forms" tailwind.config.js && make css 2>&1 | tail -5</automated>
    <manual>base.html contains color-scheme meta, two preload links with crossorigin, tailwind.config.js has darkMode: 'selector' and @tailwindcss/forms plugin</manual>
  </verify>
  <done>base.html has color-scheme meta tag, two font preload links with crossorigin attributes, tailwind.config.js has darkMode: 'selector' and @tailwindcss/forms plugin, and `make css` builds successfully</done>
</task>

</tasks>

<verification>
1. Both font files exist at `app/static/fonts/InterVariable.woff2` and `app/static/fonts/JetBrainsMonoVariable.woff2` with non-zero sizes
2. `@font-face` declarations in `input.css` precede `@tailwind base;` and use `/static/fonts/` URL paths
3. `base.html` contains `<meta name="color-scheme" content="dark">`, two preload links with `crossorigin`
4. `tailwind.config.js` has `darkMode: 'selector'` and `require('@tailwindcss/forms')` in plugins
5. `make css` succeeds without errors
6. `pytest tests/ -x -q` passes (no regressions from base.html changes)
</verification>

<success_criteria>
- Font infrastructure is in place: files downloaded, @font-face declared, preload links in base.html
- Browser dark-mode signal is active: color-scheme meta tag and CSS property set
- Tailwind config is updated: darkMode selector and forms plugin activated
- Build pipeline works: `make css` completes successfully
- No test regressions
</success_criteria>

<output>
After completion, create `.planning/phases/11-foundation-design-tokens-base-css/11-01-SUMMARY.md`
</output>
